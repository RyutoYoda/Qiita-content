---
title: Bigtableのワイドテーブルとナローテーブルについて
tags:
  - nosql
  - Bigtable
  - GoogleCloud
private: false
updated_at: '2024-06-15T23:17:17+09:00'
id: 75aeda56221076577cab
organization_url_name: null
slide: false
ignorePublish: false
---
## はじめに
Google Cloud Bigtableは、低遅延かつ高スループットを提供するNoSQLデータベースサービスであり、大量のデータ保存と分析に適しています。Bigtableの設計において重要な概念の一つに"ワイドテーブル"と"ナローテーブル"があります。本記事では、これらの概念について詳しく説明し、それぞれの利点と欠点、そしてどのような状況でどちらのテーブル設計を選択するべきかについて考察します。

## ワイドテーブル
ワイドテーブルとは、各行が大量のカラムを持つテーブルのことです。以下に例を示します。

#### ワイドテーブルの例
```plaintext
Row Key  | Col1 | Col2 | Col3 | Col4 | Col5 | ...
---------|------|------|------|------|------|------
Row1     | 10   | 20   | 30   | 40   | 50   | ...
Row2     | 15   | 25   | 35   | 45   | 55   | ...
...
```

#### 特徴
- **大量のカラム**：各行に多数のカラムが存在します。
- **スキャンの増加**：データを取得するために、広範囲のスキャンが必要になることがあります。
- **カラム指向**：カラムごとにデータを管理するため、カラムが多い場合に有効です。

#### 利点
- **時系列データの管理**：行のキーとタイムスタンプを組み合わせることで、時系列データを効率的に管理できます。
- **データの構造化**：特定のカラムに対して細かい制御が可能です。

#### 欠点
- **スキャンコストの増加**：クエリ実行時に多くのカラムをスキャンする必要があるため、スキャンコストが増加する可能性があります。
- **データの冗長性**：関連するデータが複数のカラムに分散するため、冗長性が増えることがあります。

## ナローテーブル
ナローテーブルとは、各行が少数のカラムを持つテーブルのことです。以下に例を示します。

#### ナローテーブルの例
```plaintext
Row Key          | Timestamp | Value
-----------------|-----------|------
Row1#20240101    | 2024-01-01| 10
Row1#20240201    | 2024-02-01| 20
Row2#20240101    | 2024-01-01| 15
Row2#20240201    | 2024-02-01| 25
...
```

#### 特徴
- **少数のカラム**：各行に少数のカラムしか存在しません。
- **キーに時間を組み込む**：行のキーに時間情報を組み込むことで、時間範囲のデータを直接取得できます。
- **行指向**：行ごとにデータを管理するため、行の追加や更新が簡単です。

#### 利点
- **クエリパフォーマンスの向上**：行キーに時間を組み込むことで、特定の時間範囲のデータを効率的に取得できます。
- **シンプルなデータ構造**：データ構造がシンプルで管理が容易です。

#### 欠点
- **行数の増加**：各タイムスタンプごとに行を追加するため、行数が増加する可能性があります。
- **データの分散**：同一のデータが複数の行に分散することがあります。

### どちらを選択するべきか
- **時系列データの管理**：データが時間依存の場合、ナローテーブルの方がクエリパフォーマンスが向上します。
- **カラム数が多い場合**：データが多くのカラムにまたがる場合、ワイドテーブルの方がデータの構造化に適しています。

## 結論
Bigtableにおけるワイドテーブルとナローテーブルの設計は、データの性質や利用目的に応じて使い分けることが重要です。ナローテーブルは特定の時間範囲のデータを迅速に取得したい場合に有効であり、ワイドテーブルは多くのカラムを持つ複雑なデータ構造を管理するのに適しています。

